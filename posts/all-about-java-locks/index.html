<!DOCTYPE html>
<html><head>
<title>All About Java Locks</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">















  






      <script src="/js/toc.js"></script>
    
    <link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">

<link rel="stylesheet" href="/scss/dark-mode.min.cb53f1bee2b8900cb4f082afbf00175d6618f281cf9a2fe8619e3b52d20b5721.css" integrity="sha256-y1PxvuK4kAy08IKvvwAXXWYY8oHPmi/oYZ47UtILVyE=" media="screen">


<link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Material+Icons">








<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="/vendor/js/md5.min.js"></script><script>
  var gitalk = new Gitalk({
  clientID: '',
  clientSecret: '',
  repo: '',
  owner: '',
  admin: [''],
  id: md5(location.pathname),
  distractionFreeMode: 'false'
  });
  window.onload = function () {
        gitalk.render('gitalk-container')
  }
</script>












</head>
<body>
    	<div id="app"><div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/posts">
                    Archive
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories">
                    Categories
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    Tags
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/index.xml">
                    RSS Feed
                </a>
                
            
            
            <div class="toc">


</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a id="navTitle" class="navbar-brand" href="https://www.lix23.com">
            雪泥鸿爪
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            <i class="material-icons" id="darkModeToggleIcon2">
                dark_mode
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://www.lix23.com">
        <div class="single-column-header-title">雪泥鸿爪</div>
        
        <div class="single-column-header-subtitle">日拱一卒，功不唐捐</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            

            <div class="post-head-wrapper-text-only"
                
            >
                <div class="post-title">
                    All About Java Locks
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2023-09-08 00:01
                        </time>
                        

                        

                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <p>在面试中很容易遇到一些locks相关的问题，在这里做一些简单的总结，</p>
<p>在 Java 中，synchronized 和 Lock 都可以用来实现线程同步，但它们之间存在一些重要的区别：</p>
<ul>
<li>synchronized</li>
</ul>
<ol>
<li>synchronized 是 Java 关键字，是 JVM 层面的实现。</li>
<li>synchronized 在代码执行完之后会自动释放锁，无需手动解锁。</li>
<li>synchronized 在获取不到锁时会进入阻塞状态，没有提供获取锁的超时时间设置。</li>
<li>synchronized 适合用于竞争不激烈，且可确保没有异常抛出或者错误发生导致无法释放锁的场景。</li>
</ol>
<ul>
<li>Lock</li>
</ul>
<ol>
<li>Lock 是一个 Java 接口，具体的实现如 ReentrantLock，是 JDK 层面的实现。</li>
<li>Lock 需要手动获取锁和释放锁，通常借助 try-finally 语句块来确保锁能够被释放。</li>
<li>Lock 提供了尝试获取锁的超时时间设置，可以避免因等待锁而导致的永久阻塞问题。</li>
<li>Lock 还提供了更多的灵活功能，例如，可以被中断的锁获取操作，锁获取的公平性和非公平性选择，以及多样化的条件对象（conditions）等。</li>
</ol>
<p>总的来说，synchronized 和 Lock 都有它们各自适用的场景。synchronized 由于其简单和方便，适合用于锁竞争不激烈的场景。而 Lock 则适用于更复杂的线程同步场景，它提供了更高的灵活性和更强的功能。</p>
<ul>
<li>无锁队列</li>
</ul>
<p>Java的java.util.concurrent包 使用了无锁或者低锁的技术来实现了线程安全的队列：</p>
<ol>
<li>ConcurrentHashMap：这是一个线程安全的HashMap的实现。它使用了一种叫做分段锁的技术，将数据分成了多个段（segment），每个段可以独立地加锁，从而允许多线程并发地访问不同的段。在Java 8中，ConcurrentHashMap进一步改进，使用了更高效的CAS操作。</li>
<li>CopyOnWriteArrayList 和 CopyOnWriteArraySet：这两个类在进行修改操作（如add和remove）时，会创建底层数组的一个新的副本，然后在新的副本上进行修改。这样可以确保在读取数据时不需要加锁。这些类适合用在读操作远多于写操作的场景。</li>
<li>ConcurrentLinkedQueue 和 ConcurrentLinkedDeque：这两个类是无锁的并发队列。它们使用了一种叫做&quot;compare-and-swap&quot;（CAS）的技术来实现并发的修改操作。</li>
<li>ConcurrentSkipListMap 和 ConcurrentSkipListSet：这两个类是基于跳表的线程安全的有序集合。它们也使用了CAS操作来实现并发的修改操作。</li>
</ol>
<p>需要注意的是，尽管这些类使用了无锁或者低锁的设计，但它们并非在所有情况下都比使用锁的集合类更快。选择使用哪种集合类，需要根据具体的应用场景和需求进行考虑。</p>
<ul>
<li>有锁队列</li>
</ul>
<p>Java的java.util.concurrent包也提供了一些使用锁的线程安全队列，这些队列通常使用内部锁（内置的synchronized锁或者显式的ReentrantLock）来保证多线程操作的原子性。以下是一些常见的有锁队列：</p>
<ol>
<li>ArrayBlockingQueue：一个由数组实现的有界阻塞队列。此队列按照 FIFO（先进先出）原则对元素进行排序。队列的头部是在队列中存在时间最长的元素，队列的尾部是存在时间最短的元素。新元素插入到队列的尾部，队列检索操作则是从队列头部开始获取元素。</li>
<li>LinkedBlockingQueue：一个由链表实现的可选容量（默认为Integer.MAX_VALUE）的阻塞队列。此队列按照 FIFO（先进先出）原则对元素进行排序。</li>
<li>PriorityBlockingQueue：一个具有优先级的无界阻塞队列。此队列中的元素按照其自然顺序进行排序，或者按照比较器（Comparator）所提供的顺序进行排序，具体取决于使用的构造函数。</li>
<li>SynchronousQueue：一个没有存储空间的阻塞队列，每一个put操作必须等待一个take操作，反之亦然。SynchronousQueue是一个内部只能包含一个元素的队列。它的内部实现是一个线程在插入数据时，它会被阻塞直到另一线程取走了数据，反之亦然。</li>
<li>LinkedTransferQueue：一个由链表实现的无界阻塞 TransferQueue。此队列按照 FIFO（先进先出）原则对元素进行排序。</li>
<li>DelayQueue：一个由PriorityQueue实现的、无界的阻塞队列，只有在延迟期满时才能从中提取元素。此队列的头部 是延迟期满后保存时间最长的 Delayed 元素。如果延迟还没有期满，则队列没有头部，并且 poll 将返回 null。</li>
</ol>
<ul>
<li>乐观锁 与 悲观锁</li>
</ul>
<p>悲观锁默认会遇到多线程并发更新场景，需要抢到锁之后再进行更新动作，而乐观锁会假定没有其他线程来进行竞争，此时会检查所要更新的值是否有变化，如果没有变化则直接update，无需抢锁，乐观锁的实现：</p>
<ol>
<li>单调递增的版本号，有改动则变动版本号；</li>
<li>采用类似CAS的方式，compare and set；</li>
</ol>

                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">最后修改于 2023-09-08</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts">
			下回<br>已经到头啦。
                </a>
                
                
                
                <a class="older-posts" href="/posts/how-to-gen-website/">
			上回<br> 如何用hugo生成静态网站
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                


<div id="gitalk-container"></div>











            </div>
        </div>
    </div>


                    </div>
            </div><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://www.lix23.com">
    
        <div class="nav-title">
            雪泥鸿爪
        </div>
        
        <div class="nav-subtitle">
            日拱一卒，功不唐捐
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/posts">
                Archive
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/categories">
                Categories
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                Tags
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/index.xml">
                RSS Feed
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
移植自 <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	all copyright reserve for lixin
	

    </div>
    
</div><div id="extraContainer" class="extra-container">
    <div class="toc-wrapper">
        

        
        <div class="toc">


</div>
        
    </div>
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top"
            :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="material-icons pagination-action-icon" id="darkModeToggleIcon">
                dark_mode
            </span>
        </a>
        
        
    </div>
</div><div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
移植自 <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	all copyright reserve for lixin
	
</div>
            </div>
    
    <script src="/js/journal.js"></script></body>
</html>
